gkg<-download.gdelt(Sys.Date()-1,"gkg")
download.gdelt<-function(date=(Sys.Date()-2),project="counts",
workdir="C:/Users/Administrator/Documents"){
datestamp<-gsub("-","",date)
if(grepl("event",tolower(project))){
project<-"events"
url<-paste("http://data.gdeltproject.org/events/",datestamp,".export.CSV.zip",sep="")
if("2013-04-01"<date){
columns<-colnames(
read.delim(
textConnection(
readLines("http://gdeltproject.org/data/lookups/CSV.header.dailyupdates.txt"))))
}
if(date<"2013-04-01"){
names(df)<-colnames(
read.delim(
textConnection(
readLines("http://gdeltproject.org/data/lookups/CSV.header.historical.txt"))))
}
Header<-FALSE
}
if(grepl("count",tolower(project))){
project<-"gkgcounts"
url<-paste("http://data.gdeltproject.org/gkg/",datestamp,".gkgcounts.csv.zip",sep="")
Header<-TRUE
}
if(grepl("gkg",tolower(project)) & !grepl("count",tolower(project))){
project<-"gkg"
url<-paste("http://data.gdeltproject.org/gkg/",datestamp,".gkg.csv.zip",sep="")
Header<-TRUE
}
dir.create(file.path(workdir,project),showWarnings=FALSE)
folderpath<-file.path(workdir,project,"export.csv")
filepath<-paste(folderpath, list.files(folderpath,c(datestamp,"*\\.csv")),sep="/")
if(!grepl(datestamp,filepath)){
destfile<-file.path(workdir,project,"export.csv.zip",sep="")
download.file(url,destfile)
dir.create(folderpath,showWarnings=FALSE)
unzip(destfile,exdir=folderpath)
filepath<-paste(folderpath, list.files(folderpath,c(datestamp,"*\\.csv")),sep="/")
}
df<-read.delim(filepath,header=Header)
if(project=="events"){names(df)<-columns}
View(df)
return(df)
}
gkg<-download.gdelt(Sys.Date()-1,"gkg")
?Date
?date
?Date
PPL<-levels(gkg$PEOPLE)
colnames(gkg)
PRSNS<-levels(gkg$PERSONS)
PRSNS[1:6]
textConnections(PRSNS[1])
textConnection(PRSNS[1])
read.table(textConnection(PRSNS[1]),sep=";")
PRSNS<-subset(PRSNS,PRSNS!="")
read.table(textConnection(PRSNS[1]),sep=";")
as.vector(read.table(textConnection(PRSNS[1]),sep=";"))
as.character(read.table(textConnection(PRSNS[1]),sep=";"))
matrix(read.table(textConnection(PRSNS[1]),sep=";"))
as.matrix(read.table(textConnection(PRSNS[1]),sep=";"))
as.matrix(read.table(textConnection(PRSNS[1]),sep=";"))[1,]
as.matrix(read.table(textConnection(PRSNS[1]),sep=";")[1,])
as.vector(read.table(textConnection(PRSNS[1]),sep=";")[1,])
prsns<-as.vector(read.table(textConnection(PRSNS[1]),sep=";")[1,])
n<-ncol(prsns)
unlist(as.vector(read.table(textConnection(PRSNS[1]),sep=";")[1,]))
PRSNS[1,2]
PRSNS[1:2]
prsns
c(prsns,PRSNS[1:2])
PRSNS<-subset(PRSNS,PRSNS!="")
workvec<-""
for(n in 1:5){
m<-ncol(read.table(textConnection(PRSNS[n]),sep=";"))
while(0<m){
workvec<-c(workvec,read.table(textConnection(PRSNS[n]),sep=";")[1,m])
m<-m-1
}
}
m
m<-ncol(read.table(textConnection(PRSNS[n]),sep=";"))
read.table(textConnection(PRSNS[n]),sep=";")[1,m]
as.character(read.table(textConnection(PRSNS[n]),sep=";")[1,m])
workvec<-""
for(n in 1:5){
m<-ncol(read.table(textConnection(PRSNS[n]),sep=";"))
while(0<m){
workvec<-c(workvec,as.character(read.table(textConnection(PRSNS[n]),sep=";")[1,m]))
m<-m-1
}
}
workvec
rm(prsns)
workvec<-""
for(n in 1:5){
m<-ncol(read.table(textConnection(PRSNS[n]),sep=";"))
while(0<m){
workvec<-unique(c(workvec,as.character(read.table(textConnection(PRSNS[n]),sep=";")[1,m])))
m<-m-1
}
}
PERSONS<-function(Date=Sys.Date()-1,project="gkg",command="return"){
if(project=="gkg"){
df<-download.gdelt(Sys.Date()-1,"gkg")
}
PRSNS<-levels(df$PERSONS)
PRSNS<-subset(PRSNS,PRSNS!="")
workvec<-""
for(n in 1:length(PRSNS)){
m<-ncol(read.table(textConnection(PRSNS[n]),sep=";"))
while(0<m){
workvec<-unique(c(workvec,as.character(read.table(textConnection(PRSNS[n]),sep=";")[1,m])))
m<-m-1
}
}
if(command=="return"){
return(workvec)
}
}
PERSONS()
